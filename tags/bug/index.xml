<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>Bug on rand0m's blog</title><link>https://rand0m42195.github.io/tags/bug/</link><description>Recent content in Bug on rand0m's blog</description><generator>Hugo -- 0.152.2</generator><language>zh</language><lastBuildDate>Tue, 14 Oct 2025 07:55:34 +0800</lastBuildDate><atom:link href="https://rand0m42195.github.io/tags/bug/index.xml" rel="self" type="application/rss+xml"/><item><title>Goè¯­è¨€å¸¸è§é”™è¯¯åˆ†æ</title><link>https://rand0m42195.github.io/posts/go-pitfall-guide/</link><pubDate>Tue, 14 Oct 2025 07:55:34 +0800</pubDate><guid>https://rand0m42195.github.io/posts/go-pitfall-guide/</guid><description>&lt;p&gt;Helloï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„Goè¯­è¨€å­¦ä¹ ç¬”è®°ï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹Goè¯­è¨€ä¸­ä¸€äº›å¸¸è§é”™è¯¯ï¼Œä»¥åŠä¸€äº›å®¹æ˜“è¢«äººè¯¯è§£çš„åœ°æ–¹ã€‚ï¼ˆå¦å¤–ï¼Œä¹Ÿæ¬¢å¤§å®¶è¿æµè§ˆæˆ‘çš„ä¸Šä¸€ç¯‡ç¬”è®°ï¼š&lt;a href="https://rand0m42195.github.io/posts/go-testing/"&gt;è¯¦è§£Go Testing&lt;/a&gt;ğŸ˜€ï¼‰&lt;/p&gt;
&lt;p&gt;ä¸ºäº†çªå‡ºé—®é¢˜ï¼Œä¸‹é¢ä¸¾çš„æŸäº›ä¾‹å­å¯èƒ½æ¯”è¾ƒæç«¯ï¼Œè¿˜æœ›å¤§å®¶ä¸è¦çº ç»“ä¾‹å­çš„ä½¿ç”¨åœºæ™¯ï¼Œæ˜ç™½å…¶ä¸­çš„é”™è¯¯åŸå› å³å¯ã€‚å¦å¤–ï¼Œæ¬¢è¿å¤§å®¶è¡¥å……ç¤ºä¾‹ğŸ«µã€‚&lt;/p&gt;
&lt;h2 id="bugs"&gt;BugsğŸ&lt;/h2&gt;
&lt;h3 id="å˜é‡é®è”½shadowing"&gt;å˜é‡é®è”½ï¼ˆshadowingï¼‰ğŸ¥·ğŸ¿&lt;/h3&gt;
&lt;p&gt;åœ¨ Go ä¸­ï¼Œå˜é‡é®è”½ï¼ˆvariable shadowingï¼‰æŒ‡çš„æ˜¯åœ¨å†…éƒ¨ä½œç”¨åŸŸä¸­å£°æ˜ä¸€ä¸ªä¸å¤–éƒ¨ä½œç”¨åŸŸä¸­åŒåçš„å˜é‡ï¼Œä»è€Œè¦†ç›–äº†å¤–éƒ¨ä½œç”¨åŸŸä¸­çš„å˜é‡ã€‚è¿™ç§bugæ¯”è¾ƒä½çº§ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°åœ¨æ¯”è¾ƒè´Ÿè½½çš„å‡½æ•°é‡Œï¼Œè€Œä¸”æ¯”è¾ƒéšè”½ï¼Œä¸å®¹æ˜“è¢«å‘ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œ&lt;code&gt;findTarget&lt;/code&gt;ä»ç»™å®šstrsä¸­æŸ¥æ‰¾ç¬¬ä¸€ä¸ªtargetï¼Œè¿”å›ç´¢å¼•ã€‚ä½†æ˜¯è¿™ä¸ªç®€å•çš„å‡½æ•°å­˜åœ¨å˜é‡é®è”½çš„bugï¼ˆåˆ°&lt;a href="https://go.dev/play/p/qrT3Ko7w--t"&gt;Go Playground&lt;/a&gt;è¿è¡Œï¼‰ï¼Œè¿”å›å€¼æ°¸è¿œæ˜¯-1ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-Go" data-lang="Go"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;func&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;findTarget&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;strs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[]&lt;/span&gt;&lt;span class="kt"&gt;string&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;target&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;string&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;strs&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;strs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;target&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id="å±é™©çš„map"&gt;å±é™©çš„mapğŸ˜ˆ&lt;/h3&gt;
&lt;h4 id="æœªåˆå§‹åŒ–"&gt;æœªåˆå§‹åŒ–&lt;/h4&gt;
&lt;p&gt;Goè¯­è¨€ä¸­æœªåˆå§‹åŒ–çš„å˜é‡çš„å€¼ä¸ºæ­¤å˜é‡ç±»å‹çš„é»˜è®¤å€¼ï¼Œmapçš„é»˜è®¤å€¼ä¸ºnilï¼Œè¯»å€¼ä¸ºnilçš„mapæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯å¯¹nilçš„mapè¿›è¡Œå†™æ“ä½œä¼šå¼•å‘Panicã€‚(åˆ°&lt;a href="https://go.dev/play/p/oOcmtpNzOlU?v=goprev"&gt;Go Playround&lt;/a&gt;è¿è¡Œ)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-Go" data-lang="Go"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="kd"&gt;func&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;m&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;map&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="kt"&gt;string&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// read from nil map, should not panic&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// write to nil map, panic!!!&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;println&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;m&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s"&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="w"&gt;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å¹¶è¡Œè¯»å†™map"&gt;å¹¶è¡Œè¯»å†™map&lt;/h4&gt;
&lt;p&gt;Goè¯­è¨€çš„&lt;strong&gt;ç¦æ­¢&lt;/strong&gt;å¤šä¸ªgoroutineåŒæ—¶è¯»å’Œå†™mapï¼ˆä¼šå¼•å‘Panicï¼‰ï¼Œå› æ­¤å¦‚æœæœ‰å¹¶è¡Œæ“ä½œmapçš„éœ€æ±‚ï¼Œå¿…é¡»ä½¿ç”¨é”ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹å¹¶è¡Œè¯»å†™mapçš„ç¤ºä¾‹ï¼Œç¨‹åºä¼šPanicï¼ˆåˆ°&lt;a href="https://go.dev/play/p/pUTxzFGMO0A?v=goprev"&gt;Go Playground&lt;/a&gt;è¿è¡Œï¼‰ã€‚&lt;/p&gt;</description></item></channel></rss>